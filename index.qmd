---
title: "<img src='C:/Users/Daniel.walsh/Desktop/Branding/Agri-Food-Regulator-Logo-CMYK.svg' style='height: 50px; width:200px; vertical-align: middle; margin-right: 10px; filter: brightness(2.25) contrast(1.2);'>Horticulture Dashboard"
format:
  dashboard:
    self-contained: true
    embed-resources: true
    mobile-responsive: true
    orientation: columns
    nav-buttons: [twitter]
    theme: flatly
    toc: true
    code-fold: true
    google-fonts: false
---

```{r}
library(extrafont)
library(ggiraph)
library(tidyverse)
library(ggridges)
library(ggplot2)
library(dplyr)
library(knitr)
library(kableExtra)
library(tidyr)
library(readxl)
library(openxlsx)
library(lubridate)
library(purrr)
library(seasonal)
library(x13binary)
library(zoo)
library(gridExtra)
library(grid)
library(forecast)
library(mFilter)
library(stringr)
library(RColorBrewer)
library(webshot2)
library(DT)
library(ggtext)
library(marquee)
library(ragg)
library(htmltools)
library(bslib)
```

```{css}
#| context:setup
.girafe, .girafe_container_std{
margin-left:5px;
margin-right:10px;
}

div[data-context="setup"]{
display:none;
}

.girafe_container_std {
width: 100% !important;
height: 100% !important;
}

.girafe_container_std svg {
width: 100% !important;
height: 100% !important;
}


.panel-tabset .panel-tabset .tab-content .girafe_container_std {
margin: 0 !important;
padding: 0 !important;
max-width: none !important;
}

.girafe_svg_wrapper {
height: auto !important;
min-height: 350px;
overflow: visible !important;
}

.card {
overflow: hidden !important;
}


.panel-tabset .panel-tabset span.bslib-full-screen-enter.badge.rounded-pill{
display: none !important;
}


.panel-tabset > .nav-tabs .nav-link {
font-family: Karla; 
font-size: 0.53rem;
font-weight: bold;
color: white;
background-color: #8fb6df;
border: 1px solid white;
}

.panel-tabset > .nav-tabs .nav-link.active {
border-top: 3px solid #3c5268;
background-color: white;
color: #3c5268;
}

.panel-tabset .panel-tabset > .nav-tabs .nav-link {
font-family: Karla; 
font-size: 0.53rem;
font-weight: normal;
color: white;
background-color: #8fb6df;
border: 1 px solid white;
}

.panel-tabset .panel-tabset > .nav-tabs .nav-link.active {
background-color: white;
color: #3c5268;
border-top: 2px solid #3c5268;
}

.panel-tabset > .nav-tabs .nav-link:hover:not(.active) {
background-color: #a2c2e3;
}

.panel-tabset .panel-tabset > .nav-tabs .nav-link:hover:not(.active) {
background-color: #a2c2e3;
}

/* Target ONLY the main top navigation bar - highly specific selectors */
#quarto-dashboard-header > nav.navbar,
#quarto-dashboard-header > nav.navbar .navbar-nav,
#quarto-dashboard-header > nav.navbar .nav-link,
#quarto-dashboard-header > nav.navbar .nav-link-text {
  font-family: "Times New Roman", Times, serif;
  font-size: 14px;
  font-weight: 400;
}

/* Main dashboard title - highly specific selector */
#quarto-dashboard-header > nav.navbar .navbar-title-text a {
  font-family: "Times New Roman", Times, serif;
  font-size: 18px;
}

/* Target the specific table on the right */
.card .table,
.card table {
  font-family: "Times New Roman", Times, serif;
  font-size: 12.5px;
}

/* Target table headings */
.card th, 
.card .table th {
  font-family: "Times New Roman", Times, serif;
  font-weight: bold;
  background-color: #8fb6df; /* Match the blue from your tabs */
}

/* Target table cells */
.card td, 
.card .table td {
  font-family: "Times New Roman", Times, serif;
}

/* Target the table caption/title */
.card table caption,
.card .table caption,
.card .table-caption {
  font-family: "Times New Roman", Times, serif;
  font-weight: bold;
  font-size: 16px;
}

/* Target the specific "Producer Price Increases by Category" heading */
.card h3, 
.card .card-title {
  font-family: "Times New Roman", Times, serif;
  font-size: 18px;
  font-weight: bold;
}

/* Target the note text under the table */
.card .note, 
.card .note-text,
.card small {
  font-family: "Times New Roman", Times, serif;
  font-size: 12px;
  font-style: italic;
}

.value-box-title.html-fill-item.html-fill-container span {
font-size: clamp(0.7rem, 2vw, 0.875rem) !important;
}


```


# Overview

## Column 1 {width="40%"}

### Row 1

::: {.card width="30%"}
```{r}
htmltools::includeMarkdown("C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\08_dashboard\\00_text\\Introduction.Rmd")
```
:::

## Column 2

### Row 1 {height="100%"}

::: panel-tabset
### Fruit

```{r}
map_data_fruit <- read_excel("C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\02_processed_data\\00_cleaned_data\\00_price_data\\00_overall\\03_value_production\\map_data_fruit.xlsx")

mycolours <- colorRampPalette(c("#8fb6df", "#3c5268"))(5)
```

```{r}

map_data_fruit_object <- map_data_fruit %>% 
  
  ggplot(aes(x = long, y = lat, group = group)) +
  
  geom_polygon_interactive(aes(fill = value,
                               tooltip = sprintf(
                                 "Country: %s\nValue of Production (€ millions): %s",
                                 country, value),
                               data_id = country)) + 
  
  scale_fill_gradientn(name = "Value of Production (€ millions)",
                      colours = mycolours,
                      na.value = "grey80") +
  
  labs(
    title = "A Comparative Glance at the Value of Fuit Production in the EU-27",
    subtitle = "**Value of Production in Producer Prices (2024):** The map shows the value of production in producer prices for the countries that make <br>up the EU-27. Ireland produced €61 million worth of fruit in 2024. This represents a 21% increase from 2015. In 2024, for every €1000 <br>worth of fruit produced in the EU-27, Ireland produced €1.70 of this. In 2015, this figure was €2.",
    caption = "Source: Eurostat 
    <br>Notes: Hover over countries to access production values at current prices. Values are € millions."
  ) +
  
  theme_minimal() +
  
  theme( 
    plot.title = element_text(face = "bold",colour = "#444444" , size = 15, hjust = 0), 
    plot.title.position = "plot",
    plot.subtitle = element_markdown( color= "#444444", size = 8.5, hjust = 0, lineheight = 1.3, margin = margin(t = 2, b = 5)),
    plot.caption.position = "plot",
    plot.caption = element_markdown(color = "#444444", size=7, hjust= 0, lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(), 
    legend.position = "none",
    legend.title = element_blank(),
    panel.background = element_rect(fill= "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    panel.spacing = unit(-1, "lines")
  ) 

hover_css <- "
fill: #ffe7a6;
 fill-opacity:0.5;
  stroke-width: 2px;
  transition: fill-opacity 0.5s, stroke-width 0.5s, filter 0.5s;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
"

map_data_fruit_interactive <- girafe(ggobj = map_data_fruit_object,
                                           options = list(
                                             opts_tooltip(
                                               zindex = 9999,
                                               css = "background-color:white;
         color:black;
         padding:10px;
         border-radius:5px;
         font-size:12pt;
         font-family:sans-serif;
         box-shadow:2px 2px 5px rgba(0,0,0,0.2);"
                                             )
                                           )
) 

map_data_fruit_interactive


```

### Vegetables

```{r}
map_data_veg <- read_excel("C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\02_processed_data\\00_cleaned_data\\00_price_data\\00_overall\\03_value_production\\map_data_veg.xlsx")

mycolours <- colorRampPalette(c("#8fb6df", "#3c5268"))(5)
```

```{r}
map_data_veg_object <- map_data_veg %>% 
  
  ggplot(aes(x = long, y = lat, group = group)) +
  
  geom_polygon_interactive(aes(fill = value,
                               tooltip = sprintf(
                                 "Country: %s\nValue of Production (€ millions): %s",
                                 country, value),
                               data_id = country)) + 
  
  scale_fill_gradientn(name = "Value of Production (€ millions)",
                      colours = mycolours,
                      na.value = "grey80") +
  
  labs(
    title = "A Comparative Glance at the Value of Fresh Vegetable Production in \nthe EU-27",
    subtitle = "**Value of Production in Producer Prices (2024):** The map shows the value of production in producer prices for the countries that make <br>up the EU-27. Ireland produced €296 million worth of fresh vegetables in 2024. This represents a 25% increase from 2015. In 2024, for <br>every €1000 worth of fresh vegetables produced in the EU-27, Ireland produced €6 of this. In 2015, this figure was €7.40.",
     caption = "Source: Eurostat 
    <br>Notes: Hover over countries to access production values at current prices. Values are € millions."
  ) +
  
  theme_minimal() +
  
  theme( 
    plot.title = element_text(face = "bold",colour = "#444444" , size = 15, hjust = 0), 
    plot.title.position = "plot",
    plot.subtitle = element_markdown( color= "#444444", size = 8.5, hjust = 0, lineheight = 1.3, margin = margin(t = 2, b = 5)),
    plot.caption.position = "plot",
    plot.caption = element_markdown(color = "#444444", size=7, hjust= 0, lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(), 
    legend.position = "none",
    legend.title = element_blank(),
    panel.background = element_rect(fill= "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    panel.spacing = unit(-1, "lines")
  ) 

hover_css <- "
fill: #ffe7a6;
 fill-opacity:0.5;
  stroke-width: 2px;
  transition: fill-opacity 0.5s, stroke-width 0.5s, filter 0.5s;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
"

map_data_veg_interactive <- girafe(ggobj = map_data_veg_object,
                                           options = list(
                                             opts_tooltip(
                                               zindex = 9999,
                                               css = "background-color:white;
         color:black;
         padding:10px;
         border-radius:5px;
         font-size:12pt;
         font-family:sans-serif;
         box-shadow:2px 2px 5px rgba(0,0,0,0.2);"
                                             )
                                           )
) 

map_data_veg_interactive

```
:::

# Food {orientation="rows"}

## Row 2 {height="100%"}

### Column 1 {width="60%"}

```{r}

food_comparison <- read_excel("C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\02_processed_data\\02_final_data\\ie_eu27_world_hicp.xlsx"
)

```

```{r}
food_comparison <- food_comparison %>% 
  mutate(date = as.Date(date))

last_values <- food_comparison %>% 
  group_by(country) %>% 
  slice_max(date) %>% 
  ungroup 

hicp_food_comparison <- 
  
  ggplot(food_comparison, aes(x = date, y = value, color = country)) +
  
  geom_line_interactive(linewidth = 0.75) +
  geom_point_interactive(aes(shape = country,
                             tooltip = sprintf(
                             "Date: %s\nValue: %s",
                             date, value
                             )
                             ), hover_nearest = TRUE,
                         size = 2) +
  geom_text(data = last_values, aes(label = country),
            size = 2.5,
            vjust = -1) +
  
  scale_shape_manual(values = c("Ireland" = 15, "EU27" = 16, "World" = 17)) +
  scale_color_manual( values = c("Ireland" = "#8fb6df", "World"= "#3495db", "EU27" = "#3c5268")) +
  labs(
    title ="Irish Food Prices Track EU-27 Patterns Despite Global Price Volatility",
    subtitle = "\n**Monthly Food Price Index Trends:**
    <span style='color:#8fb6df;'>**Ireland**</span>,
    <span style='color:#3c5268;'>**EU27**</span> and
    <span style='color:#3495db;'>**World**</span> (2023-2024).
    <br>The graph shows relative movements in consumer prices between Ireland, EU27       and World indices. Irish food prices rose by 6.5% from January 2023 <br>to December 
2024. Both EU27 and Irish consumer prices for food have been less volatile than world food prices over the past 2 years.",
    caption = "Source: Eurostat, FAO",
    x = "Date",
    y = "Price Index",
    color = "Region"
  ) +
  theme_minimal() +
  
    theme( 
    plot.title = element_text(face = "bold",colour = "#444444" , size = 15, hjust = 0), 
    plot.title.position = "plot",
    plot.subtitle = element_markdown( color= "#444444", size = 8.5, hjust = 0, lineheight = 1.3, margin = margin(t = 2, b = 5)),
    plot.caption.position = "plot",
    plot.caption = element_markdown(color = "#444444", size=7, hjust= 0, lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_text(size = 7, colour = "darkgray"),
    axis.line.y = element_line(colour = "darkgray", linewidth = 0.25),
    axis.line.x = element_line(colour = "darkgray", linewidth = 0.25),
    axis.ticks.y = element_line(colour = "darkgray", linewidth = 0.25),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_line(color = "#EEEEEE"), 
    legend.position = "none",
    legend.title = element_blank(),
    panel.background = element_rect(fill= "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    panel.spacing = unit(-1, "lines")
    )  +
  scale_y_continuous(
    expand = c(0,0),
    limits = c(100, 150)
  )  +
  scale_x_date(limits = c(
    make_date(2023,1,1),
    make_date(2025,1,1)),
    breaks = as.Date(c("2023-01-01", "2024-01-01", "2025-01-01")),
    labels = c("Jan 2023", "Jan 2024", "Jan 2025")
    )

hover_css <- "
fill: #ffe7a6;
 fill-opacity:0.5;
  stroke-width: 2px;
  transition: fill-opacity 0.5s, stroke-width 0.5s, filter 0.5s;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
"

hicp_food_comparison_interactive <- girafe(ggobj = hicp_food_comparison,
                               options = list(
                                  opts_hover(css = hover_css),
                                  opts_hover_inv(css = "opacity:0.02"),
                                  opts_tooltip(
                                    zindex = 9999,
                                    css = "background-color:white;
         color:black;
         padding:10px;
         border-radius:5px;
         font-size:12pt;
         font-family:sans-serif;
         box-shadow:2px 2px 5px rgba(0,0,0,0.2);"
                                  )
         )
         ) 

hicp_food_comparison_interactive
```

### Column 2

```{r}
bslib::value_box(
  title = HTML("<span style='font-size:0.95rem'>Consumer Food Price Increase (2023-2024) - Ireland:</span>"),
  value = "6.5%",
  theme =  value_box_theme(
    bg = "#3c5268",
    fg = "white"
  ),
  showcase = tags$img(src = "C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\09_icons\\ireland.png", height = 65),
  
  
)
```

```{r}
bslib::value_box(
  title = HTML("<span style='font-size:0.95rem'>Consumer Food Price Increase (2023-2024) - EU27:</span>"),
  value = "6.2%",
  theme =  value_box_theme(
    bg = "#8fb6df",
    fg = "white"
  ),
  showcase = tags$img(src = "C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\09_icons\\eu.png", height = 65),
  
  
)
```

```{r}
bslib::value_box(
  title = HTML("<span style='font-size:0.95rem'>Consumer Food Price Increase (2023-2024)- World:</span>"),
  value = "-3.3%",
  theme =  value_box_theme(
    bg = "#3c5268",
    fg = "white"
  ),
  showcase = tags$img(src = "C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\09_icons\\world.png", height = 65),
  
  
)
```

# Fruit {orientation="rows"}

## Row 2 {height="auto"}

### Column 1 {width="61.5%"}

:::::::: panel-tabset
### Producer Prices

::: panel-tabset
#### Figure 1 {scrolling="false" expandable="false"}

```{r}
cleaned_ppi_data <- read_excel("C:/Users/Daniel.walsh/Desktop/Horticulture/Horticulture/Projects/01_horticulture_public_data_projects/00_horticulture_public_data_report_2025/02_processed_data/00_cleaned_data/00_price_data/00_overall/01_producer_indices/cc_ppi_b2015.xlsx")
```

```{r}
fruit_comparison <- cleaned_ppi_data %>% 
  filter(
    category == "Fruit",
    country %in% c("Netherlands", "Spain", "EU27", "United Kingdom", "Belgium", "France", "Ireland")
  )

last_values <- fruit_comparison %>% 
  filter(country %in% c("Ireland", "United Kingdom", "Belgium", "Spain", "EU27", "Netherlands")) %>% 
  group_by(country) %>% 
  slice_max(date) %>% 
  ungroup() 

label_positions <- last_values %>% 
  mutate(y_position = case_when(
    country == "Belgium" ~ value +3,
    country == "Ireland" ~ value -8,
    country == "United Kingdom"~ value + 3.5,
    country == "EU27"~ value  +4,
    country == "Netherlands"~ value -11.5,
    country == "Spain"~ value -45
  ),
  x_position = case_when(
    country == "Belgium" ~ date - days(0),
    country == "Ireland" ~ date - days(0),
    country == "United Kingdom"~ date - days(0),
    country == "EU27"~ date - days(0),
    country == "Netherlands"~ date - days(1800),
    country == "Spain"~ date - days(970)
  )
  )

new_row <-  data.frame(
  date = as.Date("2015-01-01"),
  value = 100.00,
  country = "Ireland",
  category = "Fruit"
)

fruit_comparison <- bind_rows(fruit_comparison, new_row) %>% 
  arrange(country, date)
  
ppi_fruit_comparison <- 
  
ggplot(fruit_comparison, aes(x = date, y = value, group = country)) +
  
  geom_line_interactive(data = fruit_comparison %>% filter(country != "Ireland"),
            color = "#8fb6df",
            alpha = 0.25,
            linewidth = 0.5) +
  
  geom_line_interactive(data = fruit_comparison %>% filter(country == "Ireland"),
            color = "#3c5268",
            linewidth = 0.75
            ) +
  
  geom_point_interactive(data = fruit_comparison %>%  filter(country == "Ireland"),
             color = "#3c5268",
             size = 2) +
  
  geom_text(data = label_positions, aes(x = x_position, y = y_position, label = country),
            size = 2.5
            ) + 
  
  theme_minimal() +
  
  labs(
    title ="Growth in Fruit Prices Paid to Primary Producers in Ireland Has Been Less \nPronounced Than in a Select Group of European Competitors since 2015",
    subtitle = "\n**Annual Trends in Producer Price Index for Fruit:** Ireland has seen less growth in prices paid to primary producers of fruit since 2015. Irish <br>prices have risen 31% in the period. While growth has been greater over the period for the select group of countries, ranging between 45% <br>in Spain to 81% in Belgium, there has been significantly more volatility in prices in these regions.",
    caption = "Source: Eurostat <br>Notes: 
    Producer prices are prices received by the primary producer for agricultural produce. Farm-gate price ex VAT. Data for Ireland is only available from 2018 onwards.",
    x = "Date",
    y = "Price Index",
    color = "Region"
  ) +
  
   theme( 
    plot.title = element_text(face = "bold",colour = "#444444" , size = 15, hjust = 0), 
    plot.title.position = "plot",
    plot.subtitle = element_markdown( color= "#444444", size = 8.5, hjust = 0, lineheight = 1.3, margin = margin(t = 2, b = 5)),
    plot.caption.position = "plot",
    plot.caption = element_markdown(color = "#444444", size=7, hjust= 0, lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_text(size = 7, colour = "darkgray"),
    axis.line.y = element_line(colour = "darkgray", linewidth = 0.25),
    axis.line.x = element_line(colour = "darkgray", linewidth = 0.25),
    axis.ticks.y = element_line(colour = "darkgray", linewidth = 0.25),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_line(color = "#EEEEEE"), 
    legend.position = "none",
    legend.title = element_blank(),
    panel.background = element_rect(fill= "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    panel.spacing = unit(-1, "lines")
    ) 


hover_css <- "
fill: #ffe7a6;
 fill-opacity:0.5;
  stroke-width: 2px;
  transition: fill-opacity 0.5s, stroke-width 0.5s, filter 0.5s;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
"

ppi_fruit_comparison_interactive <- girafe(ggobj = ppi_fruit_comparison,
                               options = list(
                                  opts_hover(css = hover_css),
                                  opts_hover_inv(css = "opacity:0.02"),
                                  opts_tooltip(
                                    zindex = 9999,
                                    css = "background-color:white;
         color:black;
         padding:10px;
         border-radius:5px;
         font-size:12pt;
         font-family:sans-serif;
         box-shadow:2px 2px 5px rgba(0,0,0,0.2);"
                                  )
         )
         ) 

ppi_fruit_comparison_interactive

```

#### Figure 2

```{r}

relative_fruit <- cleaned_ppi_data %>% 
 filter(category == "Fruit") 

eu27_reference_fruit <- relative_fruit %>% 
  filter(country == "EU27") %>% 
  select(date, eu27_value = value)


new_row <-  data.frame(
  date = as.Date("2015-01-01"),
  value = 100.00,
  country = "Ireland",
  category = "Fruit"
)

relative_fruit <- bind_rows(relative_fruit, new_row) %>% 
  arrange(country, date)

relative_fruit <- relative_fruit %>% 
  left_join(eu27_reference_fruit, by = "date") %>% 
  mutate(
    relative_index = (value/eu27_value)*100,
    relative_index = round(relative_index,2)
  )

last_values_fruit_index <- relative_fruit %>% 
  filter(country %in% c("Ireland", "United Kingdom", "Belgium", "Spain", "EU27", "Netherlands")) %>% 
  group_by(country) %>% 
  slice_max(date) %>% 
  ungroup()

label_positions_fruit_index <- last_values_fruit_index %>% 
  mutate(y_position = case_when(
    country == "Belgium" ~ value -60,
    country == "Ireland" ~ value -50,
    country == "United Kingdom"~ value -36,
    country == "EU27"~ value  -50,
    country == "Netherlands"~ value -35,
    country == "Spain"~ value -70
  ),
  x_position = case_when(
    country == "Belgium" ~ date - days(0),
    country == "Ireland" ~ date - days(0),
    country == "United Kingdom"~ date - days(0),
    country == "EU27"~ date - days(0),
    country == "Netherlands"~ date - days(1825),
    country == "Spain"~ date - days(1095)
  )
  )

relative_fruit <- relative_fruit %>% 
  filter(country != "Poland")
```

```{r}
relative_fruit_index <- ggplot(relative_fruit, aes(x = date, y = relative_index, group = country)) +
  
  geom_line_interactive(data = relative_fruit %>% filter(!(country %in% c("Ireland", "EU27", "Poland"))),
            color = "#8fb6df",
            alpha = 0.25,
            linewidth = 0.5) +
  
  geom_line_interactive(data = relative_fruit %>% filter(country == "Ireland"), 
            color = "#3c5268",
            linewidth = 0.75
  ) +
  
  geom_line_interactive(data = relative_fruit %>% filter(country == "EU27"),
            colour = "darkgray",
            linetype = "dashed"
            ) +
  
  geom_point_interactive(data = relative_fruit %>%  filter(country == "Ireland"), 
             color = "#3c5268",
             size = 2) +
  
  geom_text(data = label_positions_fruit_index, aes(x = x_position, y = y_position, label = country),
            size = 2.5
  ) +
  
  theme_minimal() +
  
  labs(
    title ="Producer Prices for Fruit Have Seen Slower Growth than an EU-27 Relative \nBenchmark",
    subtitle = "\n**Comparative Producer Price Dynamics for Fruit:** Prices paid to agricultural producers of fruit have seen slower growth since 2015 than the EU27 <br>as 
    a whole. Cumulative price growth since 2020 has diverged with the rest of the continent. This divergence has enhanced Ireland's competitiveness <br>relative 
    to the EU benchmark and its close competitors.This may help firms focused on export markets, and limit margin growth for those who supply <br>the domestic market.",
    caption = "Source: Eurostat <br>Notes: 
    Producer prices are prices received by the primary producer for agricultural produce. Farm-gate price ex VAT. The relative indices are calculated as 
    <br>(PPI Country<sub>i</sub><sup>t</sup>)/(PPI EU-27<sup>t</sup>). A value >100 indicates higher inflationary pressure relative to the benchmark, a value <100 indicates lower inflationary pressure.
    <br> If country A's relative index > country B's relative index, this signals an improvement in competitiveness for country B relative to country A",
    x = "Date",
    y = "Price Index",
    color = "Region"
  ) +
  
   theme( 
    plot.title = element_text(face = "bold",colour = "#444444" , size = 15, hjust = 0), 
    plot.title.position = "plot",
    plot.subtitle = element_markdown( color= "#444444", size = 8.5, hjust = 0, lineheight = 1.3, margin = margin(t = 2, b = 5)),
    plot.caption.position = "plot",
    plot.caption = element_markdown(color = "#444444", size=7, hjust= 0, lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_text(size = 7, colour = "darkgray"),
    axis.line.y = element_line(colour = "darkgray", linewidth = 0.25),
    axis.line.x = element_line(colour = "darkgray", linewidth = 0.25),
    axis.ticks.y = element_line(colour = "darkgray", linewidth = 0.25),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_line(color = "#EEEEEE"), 
    legend.position = "none",
    legend.title = element_blank(),
    panel.background = element_rect(fill= "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    panel.spacing = unit(-1, "lines")
    ) +
  
  
  scale_y_continuous(limits = c(60, 150 ))


hover_css <- "
fill: #ffe7a6;
 fill-opacity:0.5;
  stroke-width: 2px;
  transition: fill-opacity 0.5s, stroke-width 0.5s, filter 0.5s;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
"

relative_fruit_index_interactive <- girafe(ggobj = relative_fruit_index,
                               options = list(
                                  opts_hover(css = hover_css),
                                  opts_hover_inv(css = "opacity:0.02"),
                                  opts_tooltip(
                                    zindex = 9999,
                                    css = "background-color:white;
         color:black;
         padding:10px;
         border-radius:5px;
         font-size:12pt;
         font-family:sans-serif;
         box-shadow:2px 2px 5px rgba(0,0,0,0.2);"
                                  )
         )
         ) 

relative_fruit_index_interactive

```
:::

### Consumer Prices

```{r}

fruit_comparison <- read_excel("C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\02_processed_data\\00_cleaned_data\\00_price_data\\00_overall\\00_consumer_indices\\ie_eu27_world_hicp.xlsx") 

fruit_comparison <- fruit_comparison %>% 
  filter(
    category %in% c("Fruit"),
    country %in% c("Ireland", "EU27")
  )


last_values_fruit <- fruit_comparison %>% 
  group_by(country) %>% 
  slice_max(date) %>% 
  ungroup

```

::: panel-tabset
#### Figure 1

```{r}
fruit_hicp_comparison <-  
  
  ggplot(fruit_comparison, aes(x = date, y = value, color = country)) +
  
  geom_line_interactive(linewidth = 0.75) +
  geom_point_interactive(aes(shape = country), size = 2) +
  geom_text(data = last_values_fruit, aes(label = country),
            size = 2.5,
            vjust = 2) +
    scale_shape_manual(values = c("Ireland" = 15, "EU27" = 16)) +
  scale_color_manual( values = c("Ireland" = "#8fb6df", "EU27" = "#3c5268")) + 
  
  labs(
    title = "Consumer Fruit Prices in Ireland Are Less Volatile Than Their Respective \nEU-27 Counterparts.",
    subtitle = "**Monthly Fruit Price Index Trends:**
     <span style='color:#8fb6df;'>**Ireland**</span>,
    <span style='color:#3c5268;'>**EU27**</span> (2023-2024). The graph shows relative movements in consumer prices between Ireland <br>and the EU-27 for an overall fruit category.
    The average absolute monthly percentage change is over twice as big for the EU27 in the overall 
    <br>fruit category relative to Ireland.",
    caption = "Source: Eurostat
    <br>Notes : Base year is 2020. Monthly data should be interpreted with caution given differneces in seasonality in fruit production acroos the EU-27."
  ) +
  
  theme_minimal() + 
  
 theme( 
    plot.title = element_text(face = "bold",colour = "#444444" , size = 15, hjust = 0), 
    plot.title.position = "plot",
    plot.subtitle = element_markdown( color= "#444444", size = 8.5, hjust = 0, lineheight = 1.3, margin = margin(t = 2, b = 5)),
    plot.caption.position = "plot",
    plot.caption = element_markdown(color = "#444444", size=7, hjust= 0, lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_text(size = 7, colour = "darkgray"),
    axis.line.y = element_line(colour = "darkgray", linewidth = 0.25),
    axis.line.x = element_line(colour = "darkgray", linewidth = 0.25),
    axis.ticks.y = element_line(colour = "darkgray", linewidth = 0.25),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_line(color = "#EEEEEE"), 
    legend.position = "none",
    legend.title = element_blank(),
    panel.background = element_rect(fill= "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    ) +
  
  scale_y_continuous(
    expand = c(0,0),
    limits = c(100, 170)
  ) +
  
  scale_x_datetime(limits = c(
    as.POSIXct("2023-01-01"),
    as.POSIXct("2025-01-01")
  ),
  date_breaks = "1 year",
  date_labels = "Jan %Y"
  )
  
hover_css <- "
fill: #ffe7a6;
 fill-opacity:0.5;
  stroke-width: 2px;
  transition: fill-opacity 0.5s, stroke-width 0.5s, filter 0.5s;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
"

fruit_hicp_comparison_interactive <- girafe(ggobj = fruit_hicp_comparison,
                               options = list(
                                  opts_hover(css = hover_css),
                                  opts_hover_inv(css = "opacity:0.02"),
                                  opts_tooltip(
                                    zindex = 9999,
                                    css = "background-color:white;
         color:black;
         padding:10px;
         border-radius:5px;
         font-size:12pt;
         font-family:sans-serif;
         box-shadow:2px 2px 5px rgba(0,0,0,0.2);"
                                  )
         )
         ) 

fruit_hicp_comparison_interactive

```

#### Figure 2

```{r}
combined_data <- read_excel("C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\02_processed_data\\00_cleaned_data\\00_price_data\\00_overall\\00_consumer_indices\\combined_data.xlsx")
```

```{r}
monthly_inflation <- combined_data %>% 
  filter(category %in% c("Fruit", "Vegetables")) %>% 
  arrange(date, country, category) %>% 
  group_by(country, category) %>% 
  mutate(
    inflation_rate = round((value - lag(value))/ lag(value) * 100, 2)
    ) %>% 
  ungroup()

diff_monthly_inflation <- monthly_inflation %>% 
  select(date, country, category, inflation_rate) %>% 
  pivot_wider(names_from = country,
              values_from = inflation_rate,
              names_prefix = "inflation_"
              ) %>% 
  
  mutate(relative_difference = round((inflation_Ireland - inflation_EU27), 2)
  ) 

diff_monthly_inflation_fruit <- diff_monthly_inflation %>%
  filter(category == "Fruit") %>%
  ggplot(
    aes(x = date, y = relative_difference)) +
  geom_col_interactive(fill = "#8fb6df") +
  geom_hline(yintercept = 0, color = "#444444") +
  theme_minimal() +
  labs(
    title = "Irish Consumer Fruit Prices Have Grown More Slowly Than the EU-27 Average \nsince 2023",
    subtitle = "**Difference Between Irish and EU-27 Monthly Inflation Rates:** The graph measures the absolute gap between
    Irish consumer fruit prices and <br>the EU-27 consumer fruit prices, in percentage points. The largest negative gaps appear in 2023 and are quite substantial.",
    caption = "Source: Eurostat <br>Notes : Monthly inflation rates are calculated as **(Index value<sub>t</sub> - Index value<sub>(t-1)</sub>)/Index value<sub>(t-1)</sub>**.
    The absolute deviation is calcualted as **inflation rate<sub>t</sub><sup>Ireland</sup> - inflation rate<sub>t</sub><sup>EU27</sup>**. <br>Monthly data should be interpreted with caution given differneces in seasonality in fruit production acroos the EU-27."
  ) +
  theme( 
    plot.title = element_text(face = "bold",colour = "#444444" , size = 15, hjust = 0), 
    plot.title.position = "plot",
    plot.subtitle = element_markdown( color= "#444444", size = 8.5, hjust = 0, lineheight = 1.3, margin = margin(t = 2, b = 5)),
    plot.caption.position = "plot",
    plot.caption = element_markdown(color = "#444444", size=7, hjust= 0, lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_text(size = 7, colour = "darkgray"),
    axis.line.y = element_line(colour = "darkgray", linewidth = 0.25),
    axis.line.x = element_line(colour = "darkgray", linewidth = 0.25),
    axis.ticks.y = element_line(colour = "darkgray", linewidth = 0.25),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_line(color = "#EEEEEE"), 
    legend.position = "none",
    legend.title = element_blank(),
    panel.background = element_rect(fill= "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    ) +
  
  scale_y_continuous(
    expand = c(0,0),
    limits = c(-4, 4),
    labels = function(x) paste0(x, "% points")
  ) +
  scale_x_datetime(limits = c(
    as.POSIXct("2023-01-01"),
    as.POSIXct("2025-01-01")
  ),
  date_breaks = "1 year",
  date_labels = "Jan %Y"
  )

hover_css <- "
fill: #ffe7a6;
 fill-opacity:0.5;
  stroke-width: 2px;
  transition: fill-opacity 0.5s, stroke-width 0.5s, filter 0.5s;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
"

diff_monthly_inflation_fruit_interactive <- girafe(ggobj = diff_monthly_inflation_fruit,
                               options = list(
                                  opts_hover(css = hover_css),
                                  opts_hover_inv(css = "opacity:0.02"),
                                  opts_tooltip(
                                    zindex = 9999,
                                    css = "background-color:white;
         color:black;
         padding:10px;
         border-radius:5px;
         font-size:12pt;
         font-family:sans-serif;
         box-shadow:2px 2px 5px rgba(0,0,0,0.2);"
                                  )
         )
         ) 

diff_monthly_inflation_fruit_interactive

```
:::

### Production

::: panel-tabset
```{r}
domestic_net_import_production <- read_excel("C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\02_processed_data\\00_cleaned_data\\01_production_data\\domestic_net_import_production.xlsx")


domestic_net_import_production$date <- as.Date(domestic_net_import_production$date)

```

#### Figure 1

```{r}
stacked_fruit_production <- 
  
  ggplot() +
  
  geom_area(data = domestic_net_import_production, aes(x = date, y = net_imports, fill = "Net Imports")
            ) +
  
  geom_area(data = domestic_net_import_production, aes(x = date, y = value, fill = "Domestic Production"),
            position = "stack") +
  
  scale_fill_manual(
    name = "Category",
    values = c("Net Imports" = "#8fb6df", "Domestic Production" = "#3c5268")
    ) +
  
  annotate("text", x = as.Date("2016-01-01"), y = 320,
           label = "Net Imports", color = "#8fb6df", fontface = "bold", size = 2.5) +
  annotate("text", x = as.Date("2008-01-01"), y = 65,
           label = "Domestic Production", color = "#3c5268", fontface = "bold", size = 2.5) +
  
    scale_x_date(date_breaks = "4 years", date_labels = "%Y") +
  
  labs(
    title = "Ireland's Fruit Supply: Rising Net Imports Meeting Growing Domestic \nDemand While Domestic Production Remains Flat",
    subtitle = "**Domestic Production and Net Import Volumes, 2000-2024:** <span style='color:#8fb6df;'>**Net Imports**</span>,
    <span style='color:#3c5268;'>**Domestic Production**</span>. Domestic fruit production has remained 
    <br>almost flat in Ireland for the last 24 years. Growing demand for fruit has been met with increased net imports.Since 2000, net imports have 
    <br>increased by 139%. This increased competition from imported fruit has the potential to exert downward pressure on domestic prices for Irish 
    <br>growers, affecting pricing structures and profitability.",
    caption = "Source: Eurostat
    <br> Notes: Production volumes are in 1000 tonnes. Net imports are calculated as imports - exports."
  ) +
  
  theme_minimal() +
  
  theme( 
    plot.title = element_text(face = "bold",colour = "#444444" , size = 15, hjust = 0), 
    plot.title.position = "plot",
    plot.subtitle = element_markdown( color= "#444444", size = 8.5, hjust = 0, lineheight = 1.3, margin = margin(t = 2, b = 5)),
    plot.caption.position = "plot",
    plot.caption = element_markdown(color = "#444444", size=7, hjust= 0, lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_text(size = 7, colour = "darkgray"),
    axis.line.y = element_line(colour = "darkgray", linewidth = 0.25),
    axis.line.x = element_line(colour = "darkgray", linewidth = 0.25),
    axis.ticks.y = element_line(colour = "darkgray", linewidth = 0.25),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_line(color = "#EEEEEE"), 
    legend.position = "none",
    legend.title = element_blank(),
    panel.background = element_rect(fill= "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    ) 
  
hover_css <- "
fill: #ffe7a6;
 fill-opacity:0.5;
  stroke-width: 2px;
  transition: fill-opacity 0.5s, stroke-width 0.5s, filter 0.5s;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
"

stacked_fruit_production_interactive <- girafe(ggobj = stacked_fruit_production,
                               options = list(
                                  opts_hover(css = hover_css),
                                  opts_hover_inv(css = "opacity:0.02"),
                                  opts_tooltip(
                                    zindex = 9999,
                                    css = "background-color:white;
         color:black;
         padding:10px;
         border-radius:5px;
         font-size:12pt;
         font-family:sans-serif;
         box-shadow:2px 2px 5px rgba(0,0,0,0.2);"
                                  )
         )
         ) 

stacked_fruit_production_interactive


```
:::

### Inputs

::: panel-tabset
#### Figure 1

```{r}

setwd("C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\01_raw_data\\04_input_costs\\all")


file_path <- "horticultural_input_index_b2020.xlsx"
  
  
input_costs <- read_excel(path = file_path) 

input_costs <- input_costs %>% 
  mutate(
    year_over_year = ((value - lag(value))/ lag(value))*100  
    ) 

input_costs <- input_costs %>% 
  mutate(
  year_over_year = round(year_over_year, 2)
) %>% 
  filter(year %in% c("2021", "2022", "2023", "2024")) %>% 
  filter(product %in% c("soft fruit", "vegetables"))

```

```{r}

input_costs$year <- as.factor(input_costs$year)

input_cost_chart <- ggplot(input_costs, aes(x = year, y = year_over_year, fill = product)) +
  
  geom_col(position = position_dodge(width = 0.5),
           width = 0.5) +
  
  annotate("text", x = 1-0.125, y = 15.5,
           label = "Fruit", color = "#8fb6df", fontface = "bold", size = 3.5) +
  
  annotate("text", x = 3-0.475, y = 20,
           label = "Vegetables", color = "#3c5268", fontface = "bold", size = 3.5) +
  
  
  scale_fill_manual(values = c("soft fruit"="#8fb6df", "vegetables"="#3c5268")) +
  
  
  scale_y_continuous(limits = c(0, 30),
                     expand = c(0,0),
                     labels = function(x) paste0(x, "%")) +
  
  labs(
    title = "Fruit and Vegetable Growers in Ireland Faced Steep Cost Increases at the \nBeginning of the Decade",
    subtitle = "**Year-Over-Year growth in Input Costs, 2020-2024:** <span style='color:#8fb6df;'>**Fruit**</span>,
    <span style='color:#3c5268;'>**Vegetables**</span>.
    Fruit and vegetable growers seen significant cost increases at the start of <br>the 2020's, mainly driven by the energy price shock associated with the war 
in Ukraine. In the last 4 years, cost increases have been front-loaded, <br>with 75% of the total increase of costs in fruit production coming in 2020 and 2021, and 70% of total cost increases for vegetable production coming <br>in the same years. This puts growers under severe pressure over a short time frame. Cost increases stabilised in 2024.",
    caption = "Source: Teagasc 
    <br>Notes: Year over year growth calculated from input price indices. Indices derived using Teagasc' ***Horticultural Crop Input Price*** reports. These indices may not be 
    <br>absolutely reflective of individual growers costs. Costs include labour, packaging, fertiliser, plant protection products, energy, other and sector specific costs. "
  ) +
  
  theme_minimal() + 
  
  theme( 
    plot.title = element_text(face = "bold",colour = "#444444" , size = 15, hjust = 0), 
    plot.title.position = "plot",
    plot.subtitle = element_markdown( color= "#444444", size = 8.5, hjust = 0, lineheight = 1.3, margin = margin(t = 2, b = 5)),
    plot.caption.position = "plot",
    plot.caption = element_markdown(color = "#444444", size=7, hjust= 0, lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_text(size = 7, colour = "darkgray"),
    axis.line.y = element_line(colour = "darkgray", linewidth = 0.25),
    axis.line.x = element_line(colour = "darkgray", linewidth = 0.25),
    axis.ticks.y = element_line(colour = "darkgray", linewidth = 0.25),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_line(color = "#EEEEEE"), 
    legend.position = "none",
    legend.title = element_blank(),
    panel.background = element_rect(fill= "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    ) 
  
hover_css <- "
fill: #ffe7a6;
 fill-opacity:0.5;
  stroke-width: 2px;
  transition: fill-opacity 0.5s, stroke-width 0.5s, filter 0.5s;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
"

input_cost_chart_interactive <- girafe(ggobj = input_cost_chart,
                               options = list(
                                  opts_hover(css = hover_css),
                                  opts_hover_inv(css = "opacity:0.02"),
                                  opts_tooltip(
                                    zindex = 9999,
                                    css = "background-color:white;
         color:black;
         padding:10px;
         border-radius:5px;
         font-size:12pt;
         font-family:sans-serif;
         box-shadow:2px 2px 5px rgba(0,0,0,0.2);"
                                  )
         )
         ) 

input_cost_chart_interactive

```

#### Figure 2

```{r}
input_ppi_comparison <- read_excel("C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\02_processed_data\\00_cleaned_data\\04_inputs\\input_ppi_comparison.xlsx") 

input_ppi_comparison_fruit <- input_ppi_comparison %>% 
  filter(product == "Fruit") %>% 
  select(product, year, year_over_year, year_over_year_ppi) %>% 
  pivot_longer(cols = c(year_over_year, year_over_year_ppi),
               names_to = "category",
               values_to = "percent")

input_ppi_comparison_fruit$year <- as.factor(input_ppi_comparison_fruit$year)
```

```{r}

input_ppi_fruit_chart <- ggplot(input_ppi_comparison_fruit, aes(x = year, y = percent, fill = category)) +
  
  geom_col(position = position_dodge(width = 0.5),
           width = 0.5) +
  
  scale_fill_manual(values = c("year_over_year"="#8fb6df", "year_over_year_ppi"="#3c5268")) +
  
  annotate("text", x = 2.875, y = 9.75,
           label = "Input cost growth \nfor Fruit", color = "#8fb6df", fontface = "bold", size = 2.95) +
  
  annotate("text", x = 1.155, y = 3,
           label = "PPI growth", color = "#3c5268", fontface = "bold", size = 2.95) +

  scale_y_continuous(limits = c(0,20),
                     expand = c(0,0),
                     labels = function(x) paste0(x, "%")) +
  
  labs(
    title = "Input Cost Growth Has Far Outpaced Growth in Prices Paid to Primary \nProducers of Fruit in Ireland in 2021, 2022 and 2023",
    subtitle = "**Year-Over-Year-Growth in Input Costs Versus PPI:** <span style='color:#8fb6df;'>**Fruit**</span>,
    <span style='color:#3c5268;'>**PPI**</span>.Growth in margins has been severely squeezed for fruit growers in Ireland, with <br>significant input cost increases not being reflected in similar increases in producer prices.",
    caption = "Source: Eurostat, Teagasc
    <br>Notes: Year over year growth calculated from input price indices. Indices derived using Teagasc' ***Horticultural Crop Input Price*** reports. These indices may not be 
    <br>absolutely reflective of individual grower costs. Costs include labour, packaging, fertiliser, plant protection products, energy, other and sector specific costs. Producer
    <br> prices are the prices received by the primary producer for agricultural products. Farm-gate price ex VAT. PPI data for 2024 is unavailable. "
  ) +
  
  theme_minimal() + 
  
  theme( 
    plot.title = element_text(face = "bold",colour = "#444444" , size = 15, hjust = 0), 
    plot.title.position = "plot",
    plot.subtitle = element_markdown( color= "#444444", size = 8.5, hjust = 0, lineheight = 1.3, margin = margin(t = 2, b = 5)),
    plot.caption.position = "plot",
    plot.caption = element_markdown(color = "#444444", size=7, hjust= 0, lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_text(size = 7, colour = "darkgray"),
    axis.line.y = element_line(colour = "darkgray", linewidth = 0.25),
    axis.line.x = element_line(colour = "darkgray", linewidth = 0.25),
    axis.ticks.y = element_line(colour = "darkgray", linewidth = 0.25),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_line(color = "#EEEEEE"), 
    legend.position = "none",
    legend.title = element_blank(),
    panel.background = element_rect(fill= "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    ) 
  
hover_css <- "
fill: #ffe7a6;
 fill-opacity:0.5;
  stroke-width: 2px;
  transition: fill-opacity 0.5s, stroke-width 0.5s, filter 0.5s;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
"

input_ppi_fruit_chart_interactive <- girafe(ggobj = input_ppi_fruit_chart,
                               options = list(
                                  opts_hover(css = hover_css),
                                  opts_hover_inv(css = "opacity:0.02"),
                                  opts_tooltip(
                                    zindex = 9999,
                                    css = "background-color:white;
         color:black;
         padding:10px;
         border-radius:5px;
         font-size:12pt;
         font-family:sans-serif;
         box-shadow:2px 2px 5px rgba(0,0,0,0.2);"
                                  )
         )
         ) 

input_ppi_fruit_chart_interactive
```
:::

### Comparative Analysis

::: panel-tabset
#### Figure 1

```{r}

comparison_fruit <- read_excel("C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\02_processed_data\\00_cleaned_data\\00_price_data\\00_overall\\02_comparative\\comparison_fruit.xlsx") 


comparison_fruit <-  comparison_fruit %>% 
  filter(country %in% c("Ireland", "EU27")) 

### Interpolating values using linear approx 

comparison_fruit_interpolated <- comparison_fruit %>% 
  
filter(variable == "value_ppi") %>% 
  
  complete(country, date) %>% 
  group_by(country) %>% 
  
  mutate(value_interpolated = na.approx(value, na.rm = FALSE, rule = 2)) %>% 
  arrange(date) 

#### Adding Manually

comparison_fruit$value[comparison_fruit$date == "2016-01-01" &
                         comparison_fruit$country == "Ireland" &
                         comparison_fruit$variable == "value_ppi"] <- 105.78

comparison_fruit$value[comparison_fruit$date == "2017-01-01" &
                         comparison_fruit$country == "Ireland" &
                         comparison_fruit$variable == "value_ppi"] <- 111.56

last_values_fruit <- comparison_fruit %>% 
  filter(date < "2024-01-01") %>% 
  group_by(country) %>% 
  slice_max(date) %>% 
  ungroup()

label_position_fruit <- last_values_fruit %>% 
  mutate(y_position = case_when(
    country == "EU27" & variable == "value_ppi" ~ value -5,
    country == "Ireland" & variable == "value_ppi"~ value +3,
    country == "Ireland" & variable == "value_hicp"~ value +3,
    country == "EU27" & variable == "value_hicp"~ value -3 
  ),
  x_position = case_when(
    country == "EU27" & variable == "value_ppi" ~ date - days(325),
    country == "Ireland" & variable == "value_ppi"~ date - days(75),
    country == "Ireland" & variable == "value_hicp"~ date - days(0),
    country == "EU27" & variable == "value_hicp"~ date + days(180) 
  ))

```

```{r}

comparison_fruit_facet <- ggplot(comparison_fruit, aes(x = date, y = value, color = variable)) +
  
geom_line(linewidth = 0.75) +
  
  geom_point(aes(shape = country), size = 2) +
  
  geom_text(data = label_position_fruit, aes(x = x_position, y = y_position,
                                             label = ifelse(variable == "value_hicp", "HICP", "PPI")), size = 2.5) +
  
  facet_wrap(~country, ncol = 2) +
  
  scale_color_manual(values = c("value_ppi" = "#3c5268", "value_hicp" = "#8fb6df"),
                     labels = c("HICP", "PPI")
  ) +
  
  scale_shape_manual(values = c("Ireland" = 15, "EU27" = 16)) +
  
  labs(
    title = "Has Producer Price Growth in Ireland for Fruit Been Subdued by Limited \nConsumer Price Growth Relative to the EU27?",
    subtitle = "**Producer and Consumer Price Divergence in Fruit Supply Chain:** There has been substantial producer price compression in the Irish fruit supply <br>chain, relative to the EU27. The low growth in consumer prices for fruit has acted as an anchor on producer price growth, relative to 
European <br>competitors. This may be accounted for by intense price competition in the retail sector, greater retailer concentration relative to EU peers, higher <br>import competition, retailer pricing strategies or potential market failures along the supply chain.",
    caption = "Source: Eurostat <br>Notes:
    Producer prices are prices received by the primary producer for agricultural produce. Farm-gate price ex VAT. Irish PPI data is marked confidential from 2015-2017. Data has <br>been interpolated for these periods"
  ) +
  
  
  theme_minimal() +
  
 
 theme( 
    plot.title = element_text(face = "bold",colour = "#444444" , size = 15, hjust = 0), 
    plot.title.position = "plot",
    plot.subtitle = element_markdown( color= "#444444", size = 8.5, hjust = 0, lineheight = 1.3, margin = margin(t = 2, b = 5)),
    plot.caption.position = "plot",
    plot.caption = element_markdown(color = "#444444", size=7, hjust= 0, lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_text(size = 7, colour = "darkgray"),
    axis.line.y = element_line(colour = "darkgray", linewidth = 0.25),
    axis.line.x = element_line(colour = "darkgray", linewidth = 0.25),
    axis.ticks.y = element_line(colour = "darkgray", linewidth = 0.25),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_line(color = "#EEEEEE"), 
    legend.position = "none",
    legend.title = element_blank(),
    panel.background = element_rect(fill= "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    ) 
  
hover_css <- "
fill: #ffe7a6;
 fill-opacity:0.5;
  stroke-width: 2px;
  transition: fill-opacity 0.5s, stroke-width 0.5s, filter 0.5s;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
"

comparison_fruit_facet_interactive <- girafe(ggobj = comparison_fruit_facet,
                               options = list(
                                  opts_hover(css = hover_css),
                                  opts_hover_inv(css = "opacity:0.02"),
                                  opts_tooltip(
                                    zindex = 9999,
                                    css = "background-color:white;
         color:black;
         padding:10px;
         border-radius:5px;
         font-size:12pt;
         font-family:sans-serif;
         box-shadow:2px 2px 5px rgba(0,0,0,0.2);"
                                  )
         )
         ) 

comparison_fruit_facet_interactive




```

#### Figure 2

```{r}
cumulative_fruit <- read_excel("C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\02_processed_data\\00_cleaned_data\\00_price_data\\00_overall\\02_comparative\\cumulative_fruit.xlsx") 
```

```{r}

 cumulative_fruit_chart <- ggplot() +
    
    geom_point(data = cumulative_fruit, aes(x = percentage, y = factor(country, levels = c("Ireland", "Spain", "Netherlands", "Belgium", "Poland")), color = variable ),
               size = 3.5, alpha = 0.9) +
      
      geom_vline(xintercept = 38.78,
                   color = "#8fb6df", linetype = 3, linewidth = 0.75 ) +
     geom_vline(xintercept = 53.53,
                color = "#3c5268", linetype = 3, linewidth = 0.75 ) +
     
    geom_text(data = data.frame(
      x = c(70, 62.5),
      y = c("Netherlands", "Ireland"),
      label = c("EU27 PPI", "EU27 HICP")
    ), aes(x = x, y = y, label = label), hjust = 0, size = 2.75, fontface = "bold", color = "#444444"
    ) +
     
     geom_segment(data = data.frame(
       x = c(68, 60.5),
       xend = c(55, 40),
       y = c("Netherlands", "Ireland"),
       yend = c("Netherlands", "Ireland")
     ),
     aes(x = x, xend = xend, y = y, yend = y),
     arrow = arrow(length = unit(0.2, "cm")),
     size = 0.35, color = "#444444"
     ) +
      
      scale_color_manual(values = c("percent_hicp" = "#8fb6df", "percent_ppi" = "#3c5268")) +
     
      scale_x_continuous(breaks = seq(-25,300, by = 25),
                         labels = function(x) paste0(x,"%")) +
     
     labs(
       title = "Since 2015, Cumulative Growth in Fruit Prices has Lagged Behind European \nCompetitors for both Consumer and Producer Prices",
       subtitle = "**Percentage Change in Price Growth for Fruit, 2015-2023: <span style='color:#8fb6df;'>**HICP**</span>,
    <span style='color:#3c5268;'>**PPI**</span>**. The graph measures the growth rates in percent for consumer and producer <br>prices since 2015. Ireland's price growth has failed to keep up relative to its peers up to 2023. Consumer prices were 30 percentage points lower <br>than the EU27 reference, 
       while producer prices were 22 percentage points lower.",
       caption = "Source: Eurostat <br>Notes: HICP and PPI data for the United Kingdom is not available in 2023 from Eurostat. The dotted lines reference EU27 growth since 2015."
     ) +
      
      theme_minimal() +
      
     theme( 
    plot.title = element_text(face = "bold",colour = "#444444" , size = 15, hjust = 0), 
    plot.title.position = "plot",
    plot.subtitle = element_markdown( color= "#444444", size = 8.5, hjust = 0, lineheight = 1.3, margin = margin(t = 2, b = 5)),
    plot.caption.position = "plot",
    plot.caption = element_markdown(color = "#444444", size=7, hjust= 0, lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_text(size = 7, colour = "darkgray"),
    axis.line.y = element_line(colour = "darkgray", linewidth = 0.25),
    axis.line.x = element_line(colour = "darkgray", linewidth = 0.25),
    axis.ticks.y = element_line(colour = "darkgray", linewidth = 0.25),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_line(color = "#EEEEEE"), 
    legend.position = "none",
    legend.title = element_blank(),
    panel.background = element_rect(fill= "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    ) 
  
hover_css <- "
fill: #ffe7a6;
 fill-opacity:0.5;
  stroke-width: 2px;
  transition: fill-opacity 0.5s, stroke-width 0.5s, filter 0.5s;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
"

cumulative_fruit_chart_interactive <- girafe(ggobj = cumulative_fruit_chart,
                               options = list(
                                  opts_hover(css = hover_css),
                                  opts_hover_inv(css = "opacity:0.02"),
                                  opts_tooltip(
                                    zindex = 9999,
                                    css = "background-color:white;
         color:black;
         padding:10px;
         border-radius:5px;
         font-size:12pt;
         font-family:sans-serif;
         box-shadow:2px 2px 5px rgba(0,0,0,0.2);"
                                  )
         )
         ) 

cumulative_fruit_chart_interactive 

   

```
:::
::::::::

### Column 2 {width="38.5%"}

::: {.card height="255px"}
```{r}
inflation_summary_ppi <- tibble(
  country = c("Ireland", "Ireland", "EU27", "EU27"),
  category = c( "Fruit", "Vegetables", "Fruit", "Vegetables"),
  inf_rate = c("31%", "29%", "54%", "48%")
) %>% 
  pivot_wider(
    names_from = country,
    values_from = inf_rate,
    id_cols = category
  )

inflation_table_ppi <- inflation_summary_ppi %>%
  kbl(
    caption = text_spec("Producer Price Increases by Category",
                        font_size = 16.5,
                        bold = TRUE,
                        color = "#444444"),
    col.names = c("", "Ireland", "EU")
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"),
    full_width = FALSE,
    position = "left"
  ) %>%
  
  row_spec(0, bold = FALSE , color = "white", background = "#8fb6df") %>% 
 
  
  collapse_rows(columns = 1) %>%
  footnote(
    general = "Comparison of inflation rates by category for Ireland and the EU-27 from 2015-2023",
    symbol = c("Source: Eurostat")
  )

inflation_table_ppi


```
:::

```{r}
bslib::value_box(
  title = HTML("<span style='font-size:1.2rem'>Squeezed Margin Growth - Fruit:</span><span style='font-size:0.85rem'>Input cost growth was 34.8 % points bigger than producer price growth (2020-2023)"),
  value = "",
  subtitle = HTML("<span style='font-size:0.75rem'>Input Cost Growth vs Producer Price Growth (2020-2023)</span>"),
  theme =  value_box_theme(
    bg = "#3c5268",
    fg = "white"
  ),
  showcase = tags$img(src = "C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\09_icons\\down-arrow.png", height = 65),
  
  
)
```

```{r}
bslib::value_box(
  title = HTML("<span style='font-size:1.2rem'>Relative Cumulative Growth - Fruit:</span><span style='font-size:0.85rem'>Cumulative growth in producer prices in Ireland was 22.3 % points below the EU27  (2015-2023)"),
  value = "",
  subtitle = HTML("<span style='font-size:0.75rem'>Input Cost Growth vs Producer Price Growth (2020-2023)</span>"),
  theme =  value_box_theme(
    bg = "#3c5268",
    fg = "white"
  ),
  showcase = tags$img(src = "C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\09_icons\\eu.png", height = 90),
  
  
)
```

# Vegetables {orientation="rows"}

## Row 2 {height="auto"}

### Column 1 {width="61.5%"}

:::::::: panel-tabset
### Producer Prices

::: panel-tabset
#### Figure 1 {scrolling="false" expandable="false"}

```{r}
cleaned_ppi_data <- read_excel("C:/Users/Daniel.walsh/Desktop/Horticulture/Horticulture/Projects/01_horticulture_public_data_projects/00_horticulture_public_data_report_2025/02_processed_data/00_cleaned_data/00_price_data/00_overall/01_producer_indices/cc_ppi_b2015.xlsx")
```

```{r}
veg_comparison <- cleaned_ppi_data %>% 
  filter(
    category == "Vegetables",
    country %in% c("Netherlands", "Spain", "EU27", "United Kingdom", "Belgium", "France", "Ireland")
  )

last_values_veg <- veg_comparison %>% 
  filter(country %in% c("Ireland", "United Kingdom", "Belgium", "Spain", "EU27", "Netherlands")) %>% 
  group_by(country) %>% 
  slice_max(date) %>% 
  ungroup()
  
label_positions <- last_values_veg %>% 
  mutate(y_position = case_when(
    country == "Belgium" ~ value -20,
    country == "Ireland" ~ value -20,
    country == "United Kingdom"~ value + 3.5,
    country == "EU27"~ value  +4,
    country == "Netherlands"~ value +1.75,
    country == "Spain"~ value -40
  ),
  x_position = case_when(
    country == "Belgium" ~ date - days(725),
    country == "Ireland" ~ date - days(220),
    country == "United Kingdom"~ date - days(0),
    country == "EU27"~ date - days(0),
    country == "Netherlands"~ date - days(140),
    country == "Spain"~ date - days(1050)
  )
  )
```

```{r}
ppi_veg_comparison <- 
  
  ggplot(veg_comparison, aes(x = date, y = value, group = country)) +
  
  geom_line(data = veg_comparison %>% filter(country != "Ireland"),
            color = "#8fb6df",
            alpha = 0.3,
            linewidth = 0.5) +
  
  geom_line(data = veg_comparison %>% filter(country == "Ireland"),
            color = "#3c5268",
            linewidth = 0.5
  ) +
  
  geom_point(data = veg_comparison %>%  filter(country == "Ireland"),
             color = "#3c5268",
             size = 1.75) +
  
  geom_text(data = label_positions, aes(x = x_position, y = y_position, label = country),
            size = 2.5
  ) + 
  
  theme_minimal() +
  
  labs(
    title ="Prices Paid to Primary Producers of Vegetables Were Almost Flat Up to 2022, \nWhile 2023 Seen An Uptick",
    subtitle = "\n**Annual Trends in Producer Price Index for Vegetables:** Relative to 2015 and to price growth in selected countries, Irish prices were flat up to <br>2022. They had risen by just 7% in the period since 2015. Prices seen some sort of a recovery into 2023, rising by 20% over the previous year, <br>but not enough to catch it's European competitors cumulative growth",
    caption = "Source: Eurostat <br>Notes: 
    Producer prices are prices received by the primary producer for agricultural produce. Farm-gate price ex VAT.",
    x = "Date",
    y = "Price Index",
    color = "Region"
  ) +
  
  
   theme( 
    plot.title = element_text(face = "bold",colour = "#444444" , size = 15, hjust = 0), 
    plot.title.position = "plot",
    plot.subtitle = element_markdown( color= "#444444", size = 8.5, hjust = 0, lineheight = 1.3, margin = margin(t = 2, b = 5)),
    plot.caption.position = "plot",
    plot.caption = element_markdown(color = "#444444", size=7, hjust= 0, lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_text(size = 7, colour = "darkgray"),
    axis.line.y = element_line(colour = "darkgray", linewidth = 0.25),
    axis.line.x = element_line(colour = "darkgray", linewidth = 0.25),
    axis.ticks.y = element_line(colour = "darkgray", linewidth = 0.25),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_line(color = "#EEEEEE"), 
    legend.position = "none",
    legend.title = element_blank(),
    panel.background = element_rect(fill= "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    panel.spacing = unit(-1, "lines")
    ) 


hover_css <- "
fill: #ffe7a6;
 fill-opacity:0.5;
  stroke-width: 2px;
  transition: fill-opacity 0.5s, stroke-width 0.5s, filter 0.5s;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
"

ppi_veg_comparison_interactive <- girafe(ggobj = ppi_veg_comparison,
                               options = list(
                                  opts_hover(css = hover_css),
                                  opts_hover_inv(css = "opacity:0.02"),
                                  opts_tooltip(
                                    zindex = 9999,
                                    css = "background-color:white;
         color:black;
         padding:10px;
         border-radius:5px;
         font-size:12pt;
         font-family:sans-serif;
         box-shadow:2px 2px 5px rgba(0,0,0,0.2);"
                                  )
         )
         ) 

ppi_veg_comparison_interactive

```

#### Figure 2

```{r}

relative_veg <- cleaned_ppi_data %>% 
  filter(category == "Vegetables")

eu27_reference_veg <- relative_veg %>% 
  filter(country == "EU27") %>% 
  select(date, eu27_value = value)

relative_veg <- relative_veg %>% 
  left_join(eu27_reference_veg, by = "date") %>% 
  mutate(
    relative_index = (value/eu27_value)*100
  )


last_values_veg_index <- relative_veg %>% 
  filter(country %in% c("Ireland", "United Kingdom", "Belgium", "Spain", "EU27", "Netherlands")) %>% 
  group_by(country) %>% 
  slice_max(date) %>% 
  ungroup()

label_positions_veg_index <- last_values_veg_index %>% 
  mutate(y_position = case_when(
    country == "Belgium" ~ value -47,
    country == "Ireland" ~ value -46,
    country == "United Kingdom"~ value -11,
    country == "EU27"~ value  -44,
    country == "Netherlands"~ value -35,
    country == "Spain"~ value -54
  ),
  x_position = case_when(
    country == "Belgium" ~ date - days(730),
    country == "Ireland" ~ date - days(0),
    country == "United Kingdom"~ date - days(0),
    country == "EU27"~ date - days(0),
    country == "Netherlands"~ date - days(1825),
    country == "Spain"~ date - days(1460)
  )
  )

relative_veg <- relative_veg %>% 
  filter(country != "Poland")
```

```{r}
relative_veg_index <- ggplot(relative_veg, aes(x = date, y = relative_index, group = country)) +
  
  geom_line(data = relative_veg %>% filter(!(country %in% c("Ireland", "EU27", "Poland"))),
            color = "#8fb6df",
            alpha = 0.3,
            linewidth = 0.5) +
  
  geom_line(data = relative_veg %>% filter(country == "Ireland"),
            color = "#3c5268",
            linewidth = 0.75
  ) +
  
  geom_line(data = relative_veg %>% filter(country == "EU27"),
            colour = "darkgray",
            linetype = "dashed"
  ) +
  
  geom_point(data = relative_veg %>%  filter(country == "Ireland"),
             color = "#3c5268",
             size = 1.75) +
  
  geom_text(data = label_positions_veg_index, aes(x = x_position, y = y_position, label = country),
            size = 2.5
  ) +
  
  theme_minimal() +
  
  labs(
    title ="Price Growth of Vegetables for Primary Producers in Ireland Has Seen \nDivergence With the EU-27, While Remaining Competitive With its Peers",
    subtitle = "\n**Comparative Producer Price Dynamics for Vegetables:** Growth in prices paid to agricultural producers of vegetables continued to diverge with the 
    <br>EU27 up to 2022.The divergence relative to its peers has been muted, indicating that Ireland has not received the benefit of lower price growth in terms 
    <br>of competitiveness. Price growth began to recover in 2023. There is significantly more price growth compression between Ireland's EU peers than for <br>fruit.",
    caption = "Source: Eurostat <br>Notes: 
    Producer prices are prices received by the primary producer for agricultural produce. Farm-gate price ex VAT. The relative indices are calculated as (PPI Country<sub>i</sub><sup>t</sup>)/(PPI EU-27<sup>t</sup>). <br>A value >100 indicates higher inflationary pressure relative to the benchmark, a value <100 indicates lower inflationary pressure.If country A's relative index > country B's relative index, <br>this signals an improvement in price competitiveness for country B relative to country A",
    x = "Date",
    y = "Price Index",
    color = "Region"
  ) +
  
   theme( 
    plot.title = element_text(face = "bold",colour = "#444444" , size = 15, hjust = 0), 
    plot.title.position = "plot",
    plot.subtitle = element_markdown( color= "#444444", size = 8.5, hjust = 0, lineheight = 1.3, margin = margin(t = 2, b = 5)),
    plot.caption.position = "plot",
    plot.caption = element_markdown(color = "#444444", size=7, hjust= 0, lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_text(size = 7, colour = "darkgray"),
    axis.line.y = element_line(colour = "darkgray", linewidth = 0.25),
    axis.line.x = element_line(colour = "darkgray", linewidth = 0.25),
    axis.ticks.y = element_line(colour = "darkgray", linewidth = 0.25),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_line(color = "#EEEEEE"), 
    legend.position = "none",
    legend.title = element_blank(),
    panel.background = element_rect(fill= "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    panel.spacing = unit(-1, "lines")
    ) +
  
  
  scale_y_continuous(limits = c(60, 150 ))


hover_css <- "
fill: #ffe7a6;
 fill-opacity:0.5;
  stroke-width: 2px;
  transition: fill-opacity 0.5s, stroke-width 0.5s, filter 0.5s;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
"

relative_veg_index_interactive <- girafe(ggobj = relative_veg_index,
                               options = list(
                                  opts_hover(css = hover_css),
                                  opts_hover_inv(css = "opacity:0.02"),
                                  opts_tooltip(
                                    zindex = 9999,
                                    css = "background-color:white;
         color:black;
         padding:10px;
         border-radius:5px;
         font-size:12pt;
         font-family:sans-serif;
         box-shadow:2px 2px 5px rgba(0,0,0,0.2);"
                                  )
         )
         ) 

relative_veg_index_interactive

```
:::

### Consumer Prices

```{r}

veg_comparison <- read_excel("C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\02_processed_data\\00_cleaned_data\\00_price_data\\00_overall\\00_consumer_indices\\ie_eu27_world_hicp.xlsx") 

veg_comparison <- veg_comparison %>% 
  filter(
    category %in% c("Vegetables"),
    country %in% c("Ireland", "EU27")
  )


last_values_veg <- veg_comparison %>% 
  group_by(country) %>% 
  slice_max(date) %>% 
  ungroup

```

::: panel-tabset
#### Figure 1

```{r}
veg_hicp_comparison <-  
  
  ggplot(veg_comparison, aes(x = date, y = value, color = country)) +
  
  geom_line_interactive(linewidth = 0.75) +
  geom_point_interactive(aes(shape = country), size = 2) +
  geom_text(data = last_values_veg, aes(label = country),
            size = 2.5,
            vjust = 2) +
    scale_shape_manual(values = c("Ireland" = 15, "EU27" = 16)) +
  scale_color_manual( values = c("Ireland" = "#8fb6df", "EU27" = "#3c5268")) + 
  
  labs(
    title = "Growth Rates in Consumer Prices for Vegetables are on Par with an EU-27 \nBenchmark, while Irish Consumer Prices Show More Stability",
    subtitle = "**Monthly Vegetable Price Index Trends:**
     <span style='color:#8fb6df;'>**Ireland**</span>,
    <span style='color:#3c5268;'>**EU27**</span> (2023-2024). The graph shows relative movements in consumer prices between Ireland <br>and the EU-27 for an overall vegetable category. While cumulative growth has been similar over the last 24 months, the dynamics of that change <br>are different. Irish consumer prices have faced less volatility, potentially signalling the differing market structures in the retail sector.",
    caption = "Source: Eurostat
    <br>Notes : Base year is 2020. Monthly data should be interpreted with caution given differneces in seasonality in vegetable production acroos the EU-27."
  ) +
  
  theme_minimal() + 
  
 theme( 
    plot.title = element_text(face = "bold",colour = "#444444" , size = 15, hjust = 0), 
    plot.title.position = "plot",
    plot.subtitle = element_markdown( color= "#444444", size = 8.5, hjust = 0, lineheight = 1.3, margin = margin(t = 2, b = 5)),
    plot.caption.position = "plot",
    plot.caption = element_markdown(color = "#444444", size=7, hjust= 0, lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_text(size = 7, colour = "darkgray"),
    axis.line.y = element_line(colour = "darkgray", linewidth = 0.25),
    axis.line.x = element_line(colour = "darkgray", linewidth = 0.25),
    axis.ticks.y = element_line(colour = "darkgray", linewidth = 0.25),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_line(color = "#EEEEEE"), 
    legend.position = "none",
    legend.title = element_blank(),
    panel.background = element_rect(fill= "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    ) +
  
  scale_y_continuous(
    expand = c(0,0),
    limits = c(100, 170)
  ) +
  
  scale_x_datetime(limits = c(
    as.POSIXct("2023-01-01"),
    as.POSIXct("2025-01-01")
  ),
  date_breaks = "1 year",
  date_labels = "Jan %Y"
  )
  
hover_css <- "
fill: #ffe7a6;
 fill-opacity:0.5;
  stroke-width: 2px;
  transition: fill-opacity 0.5s, stroke-width 0.5s, filter 0.5s;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
"

veg_hicp_comparison_interactive <- girafe(ggobj = veg_hicp_comparison,
                               options = list(
                                  opts_hover(css = hover_css),
                                  opts_hover_inv(css = "opacity:0.02"),
                                  opts_tooltip(
                                    zindex = 9999,
                                    css = "background-color:white;
         color:black;
         padding:10px;
         border-radius:5px;
         font-size:12pt;
         font-family:sans-serif;
         box-shadow:2px 2px 5px rgba(0,0,0,0.2);"
                                  )
         )
         ) 

veg_hicp_comparison_interactive

```

#### Figure 2

```{r}
combined_data <- read_excel("C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\02_processed_data\\00_cleaned_data\\00_price_data\\00_overall\\00_consumer_indices\\combined_data.xlsx")
```

```{r}
monthly_inflation <- combined_data %>% 
  filter(category %in% c("Fruit", "Vegetables")) %>% 
  arrange(date, country, category) %>% 
  group_by(country, category) %>% 
  mutate(
    inflation_rate = round((value - lag(value))/ lag(value) * 100, 2)
    ) %>% 
  ungroup()

diff_monthly_inflation <- monthly_inflation %>% 
  select(date, country, category, inflation_rate) %>% 
  pivot_wider(names_from = country,
              values_from = inflation_rate,
              names_prefix = "inflation_"
              ) %>% 
  
  mutate(relative_difference = round((inflation_Ireland - inflation_EU27), 2)
  ) 

diff_monthly_inflation_veg <- diff_monthly_inflation %>%
  filter(category == "Vegetables") %>%
  ggplot(
    aes(x = date, y = relative_difference)) +
  geom_col(fill = "#3c5268", alpha = 0.75) +
  geom_hline(yintercept = 0, color = "#444444") +
  theme_minimal() +
  labs(
    title = "Monthly Inflation Rates For Vegetables in Ireland have Been Greater Than \nThe EU-27 Baseline in the Preceeding 24 Months.",
    subtitle = "**Difference Between Irish and EU-27 Monthly Inflation Rates:** The graph measures the gap between monthly inflation rates for
    Irish consumer <br>vegetable prices and EU-27 consumer vegetable prices, in percentage points. The gap between Irish and EU-27 inflation rates has generally been <br>positive
    over the last two years, even with consumer prices in Ireland rising by 12%.",
    caption = "Source: Eurostat <br>Notes : Monthly inflation rates are calculated as **(Index value<sub>t</sub> - Index value<sub>(t-1)</sub>)/Index value<sub>(t-1)</sub>**.
    The absolute deviation is calcualted as **inflation rate<sub>t</sub><sup>Ireland</sup>- inflation rate<sub>t</sub><sup>EU27</sup>**"
  ) +
  theme( 
    plot.title = element_text(face = "bold",colour = "#444444" , size = 15, hjust = 0), 
    plot.title.position = "plot",
    plot.subtitle = element_markdown( color= "#444444", size = 8.5, hjust = 0, lineheight = 1.3, margin = margin(t = 2, b = 5)),
    plot.caption.position = "plot",
    plot.caption = element_markdown(color = "#444444", size=7, hjust= 0, lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_text(size = 7, colour = "darkgray"),
    axis.line.y = element_line(colour = "darkgray", linewidth = 0.25),
    axis.line.x = element_line(colour = "darkgray", linewidth = 0.25),
    axis.ticks.y = element_line(colour = "darkgray", linewidth = 0.25),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_line(color = "#EEEEEE"), 
    legend.position = "none",
    legend.title = element_blank(),
    panel.background = element_rect(fill= "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    ) +
  
  scale_y_continuous(
    expand = c(0,0),
    limits = c(-6.5, 6),
    labels = function(x) paste0(x, "% points")
  ) +
  scale_x_datetime(limits = c(
    as.POSIXct("2023-01-01"),
    as.POSIXct("2025-01-01")
  ),
  date_breaks = "1 year",
  date_labels = "Jan %Y"
  )


hover_css <- "
fill: #ffe7a6;
 fill-opacity:0.5;
  stroke-width: 2px;
  transition: fill-opacity 0.5s, stroke-width 0.5s, filter 0.5s;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
"

diff_monthly_inflation_veg_interactive <- girafe(ggobj = diff_monthly_inflation_veg,
                               options = list(
                                  opts_hover(css = hover_css),
                                  opts_hover_inv(css = "opacity:0.02"),
                                  opts_tooltip(
                                    zindex = 9999,
                                    css = "background-color:white;
         color:black;
         padding:10px;
         border-radius:5px;
         font-size:12pt;
         font-family:sans-serif;
         box-shadow:2px 2px 5px rgba(0,0,0,0.2);"
                                  )
         )
         ) 

diff_monthly_inflation_veg_interactive

```
:::

### Production

::: panel-tabset
```{r}
domestic_net_import_production_veg <- read_excel("C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\02_processed_data\\00_cleaned_data\\01_production_data\\domestic_net_import_production_veg.xlsx")

domestic_net_import_production_veg$date <- as.Date(domestic_net_import_production_veg$date)

```

#### Figure 1

```{r}
stacked_veg_production <- 
  
  ggplot() +
  
  geom_area(data = domestic_net_import_production_veg, aes(x = date, y = value, fill= "Domestic Production")
  ) +
  
  geom_area(data = domestic_net_import_production_veg, aes(x = date, y = net_imports, fill = "Net Imports"),
            position = "stack"
  ) +
  
  annotate("text", x = as.Date("2016-01-01"), y = 320,
           label = "Net Imports", color = "#8fb6df", fontface = "bold", size = 2.5) +
  annotate("text", x = as.Date("2007-06-01"), y = 650,
           label = "Domestic Production", color = "#3c5268", fontface = "bold", size = 2.5)+

  scale_fill_manual(
    name = "Category",
    values = c("Net Imports" = "#8fb6df", "Domestic Production" = "#3c5268")
  ) +
  
  scale_x_date(date_breaks = "4 years", date_labels = "%Y") +
  
  scale_y_continuous(limits = c(0,800)) +
  
  labs(
    title = "The Shrinking Gap: The Gap Between Net Imports and Domestic Production \nof Vegetables in Ireland has Been Converging Over the Last 24 Years",
    subtitle = "**Domestic Production and Net Import Volumes, 2000-2024:** <span style='color:lightblue;'>**Net Imports**</span>,
    <span style='color:darkblue;'>**Domestic Production**</span>.
    <br>While domestic production of vegetables in 2024 is still greater than the amount of net imports into the country, the gap between the two has shrunk 
    <br>significantly since 2000. In 2000, domestic production of vegetables represented almost 4 times the amount of net imports into the country. In 2024, 
    <br>this gap has shrunk by 70%, driven by rising net imports and falling domestic production.",
    caption = "Source: Eurostat 
   <br>Notes: Production volumes are in 1000 tonnes. Potatoes included in domestic production volumes."
  ) +
  
  theme_minimal() +
  
  theme( 
    plot.title = element_text(face = "bold",colour = "#444444" , size = 15, hjust = 0), 
    plot.title.position = "plot",
    plot.subtitle = element_markdown( color= "#444444", size = 8.5, hjust = 0, lineheight = 1.3, margin = margin(t = 2, b = 5)),
    plot.caption.position = "plot",
    plot.caption = element_markdown(color = "#444444", size=7, hjust= 0, lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_text(size = 7, colour = "darkgray"),
    axis.line.y = element_line(colour = "darkgray", linewidth = 0.25),
    axis.line.x = element_line(colour = "darkgray", linewidth = 0.25),
    axis.ticks.y = element_line(colour = "darkgray", linewidth = 0.25),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_line(color = "#EEEEEE"), 
    legend.position = "none",
    legend.title = element_blank(),
    panel.background = element_rect(fill= "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    ) 
  
hover_css <- "
fill: #ffe7a6;
 fill-opacity:0.5;
  stroke-width: 2px;
  transition: fill-opacity 0.5s, stroke-width 0.5s, filter 0.5s;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
"

stacked_veg_production_interactive <- girafe(ggobj = stacked_veg_production,
                               options = list(
                                  opts_hover(css = hover_css),
                                  opts_hover_inv(css = "opacity:0.02"),
                                  opts_tooltip(
                                    zindex = 9999,
                                    css = "background-color:white;
         color:black;
         padding:10px;
         border-radius:5px;
         font-size:12pt;
         font-family:sans-serif;
         box-shadow:2px 2px 5px rgba(0,0,0,0.2);"
                                  )
         )
         ) 

stacked_veg_production_interactive


```
:::

### Inputs

::: panel-tabset
#### Figure 1

```{r}

setwd("C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\01_raw_data\\04_input_costs\\all")


file_path <- "horticultural_input_index_b2020.xlsx"
  
  
input_costs <- read_excel(path = file_path) 

input_costs <- input_costs %>% 
  mutate(
    year_over_year = ((value - lag(value))/ lag(value))*100  
    ) 

input_costs <- input_costs %>% 
  mutate(
  year_over_year = round(year_over_year, 2)
) %>% 
  filter(year %in% c("2021", "2022", "2023", "2024")) %>% 
  filter(product %in% c("soft fruit", "vegetables"))

```

```{r}

input_costs$year <- as.factor(input_costs$year)

input_cost_chart <- ggplot(input_costs, aes(x = year, y = year_over_year, fill = product)) +
  
  geom_col(position = position_dodge(width = 0.5),
           width = 0.5) +
  
  annotate("text", x = 1-0.125, y = 15.5,
           label = "Fruit", color = "#8fb6df", fontface = "bold", size = 3.5) +
  
  annotate("text", x = 3-0.475, y = 20,
           label = "Vegetables", color = "#3c5268", fontface = "bold", size = 3.5) +
  
  
  scale_fill_manual(values = c("soft fruit"="#8fb6df", "vegetables"="#3c5268")) +
  
  
  scale_y_continuous(limits = c(0, 30),
                     expand = c(0,0),
                     labels = function(x) paste0(x, "%")) +
  
  labs(
    title = "Fruit and Vegetable Growers in Ireland Faced Steep Cost Increases at the \nBeginning of the Decade",
    subtitle = "**Year-Over-Year growth in Input Costs, 2020-2024:** <span style='color:#8fb6df;'>**Fruit**</span>,
    <span style='color:#3c5268;'>**Vegetables**</span>.
    Fruit and vegetable growers seen significant cost increases at the start of <br>the 2020's, mainly driven by the energy price shock associated with the war 
in Ukraine. In the last 4 years, cost increases have been front-loaded, <br>with 75% of the total increase of costs in fruit production coming in 2020 and 2021, and 70% of total cost increases for vegetable production coming <br>in the same years. This puts growers under severe pressure over a short time frame. Cost increases stabilised in 2024.",
    caption = "Source: Teagasc 
    <br>Notes: Year over year growth calculated from input price indices. Indices derived using Teagasc' ***Horticultural Crop Input Price*** reports. These indices may not be 
    <br>absolutely reflective of individual growers costs. Costs include labour, packaging, fertiliser, plant protection products, energy, other and sector specific costs. "
  ) +
  
  theme_minimal() + 
  
  theme( 
    plot.title = element_text(face = "bold",colour = "#444444" , size = 15, hjust = 0), 
    plot.title.position = "plot",
    plot.subtitle = element_markdown( color= "#444444", size = 8.5, hjust = 0, lineheight = 1.3, margin = margin(t = 2, b = 5)),
    plot.caption.position = "plot",
    plot.caption = element_markdown(color = "#444444", size=7, hjust= 0, lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_text(size = 7, colour = "darkgray"),
    axis.line.y = element_line(colour = "darkgray", linewidth = 0.25),
    axis.line.x = element_line(colour = "darkgray", linewidth = 0.25),
    axis.ticks.y = element_line(colour = "darkgray", linewidth = 0.25),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_line(color = "#EEEEEE"), 
    legend.position = "none",
    legend.title = element_blank(),
    panel.background = element_rect(fill= "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    ) 
  
hover_css <- "
fill: #ffe7a6;
 fill-opacity:0.5;
  stroke-width: 2px;
  transition: fill-opacity 0.5s, stroke-width 0.5s, filter 0.5s;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
"

input_cost_chart_interactive <- girafe(ggobj = input_cost_chart,
                               options = list(
                                  opts_hover(css = hover_css),
                                  opts_hover_inv(css = "opacity:0.02"),
                                  opts_tooltip(
                                    zindex = 9999,
                                    css = "background-color:white;
         color:black;
         padding:10px;
         border-radius:5px;
         font-size:12pt;
         font-family:sans-serif;
         box-shadow:2px 2px 5px rgba(0,0,0,0.2);"
                                  )
         )
         ) 

input_cost_chart_interactive

```

#### Figure 2

```{r}
input_ppi_comparison <- read_excel("C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\02_processed_data\\00_cleaned_data\\04_inputs\\input_ppi_comparison.xlsx") 

input_ppi_comparison_veg <- input_ppi_comparison %>% 
  filter(product == "Vegetables") %>% 
  select(product, year, year_over_year, year_over_year_ppi) %>% 
  pivot_longer(cols = c(year_over_year, year_over_year_ppi),
               names_to = "category",
               values_to = "percent")

input_ppi_comparison_veg$year <- as.factor(input_ppi_comparison_veg$year)
```

```{r}

input_ppi_veg_chart <- ggplot(input_ppi_comparison_veg, aes(x = year, y = percent, fill = category)) +
  
  geom_col(position = position_dodge(width = 0.5),
           width = 0.5) +
  
  scale_fill_manual(values = c("year_over_year"="#8fb6df", "year_over_year_ppi"="#3c5268")) +
  
  annotate("text", x = 1.875, y = 28.25,
           label = "Input cost growth \nfor Vegetables", color = "#8fb6df", fontface = "bold", size = 2.95) +
  
  annotate("text", x = 3.125, y = 21.5,
           label = "PPI growth", color = "#3c5268", fontface = "bold", size = 2.95) +
  
  scale_y_continuous(limits = c(0,32.5),
                     expand = c(0,0),
                     labels = function(x) paste0(x, "%")) +
  
  labs(
    title = "2023 Sees Margin Growth Recover Somewhat for Vegetable Growers, But \nPrice Growth Suppression in Previous Years Leaves Farmers Worse Off",
    subtitle = "**Year-Over-Year-Growth in Input Costs Versus PPI:** <span style='color:lightblue;'>**Vegetables**</span>,
    <span style='color:darkblue;'>**PPI**</span>.
    <br>Unlike fruit growers, primary producers of vegetables have seen some recovery in margin growth up to 2023. Despite the difference in growth between 
    <br>input costs and producer prices, the effects of the margin growth squeeze in 2021 and 2022 still leave producers worse off.",
    caption = "Source: Eurostat, Teagasc
    <br>Notes: Year over year growth calculated from input price indices. Indices derived using Teagasc' ***Horticultural Crop Input Price*** reports. These indices may not be 
absolutely reflective <br>of individual grower costs. Costs include labour, packaging, fertiliser, plant protection products, energy, other and sector specific costs. Producer
prices are the prices received by the <br>primary producer for agricultural products. Farm-gate price ex VAT. PPI data for 2024 is unavailable. "
  ) +
  
  theme_minimal() + 
  
  theme( 
    plot.title = element_text(face = "bold",colour = "#444444" , size = 15, hjust = 0), 
    plot.title.position = "plot",
    plot.subtitle = element_markdown( color= "#444444", size = 8.5, hjust = 0, lineheight = 1.3, margin = margin(t = 2, b = 5)),
    plot.caption.position = "plot",
    plot.caption = element_markdown(color = "#444444", size=7, hjust= 0, lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_text(size = 7, colour = "darkgray"),
    axis.line.y = element_line(colour = "darkgray", linewidth = 0.25),
    axis.line.x = element_line(colour = "darkgray", linewidth = 0.25),
    axis.ticks.y = element_line(colour = "darkgray", linewidth = 0.25),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_line(color = "#EEEEEE"), 
    legend.position = "none",
    legend.title = element_blank(),
    panel.background = element_rect(fill= "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    ) 
  
hover_css <- "
fill: #ffe7a6;
 fill-opacity:0.5;
  stroke-width: 2px;
  transition: fill-opacity 0.5s, stroke-width 0.5s, filter 0.5s;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
"

input_ppi_veg_chart_interactive <- girafe(ggobj = input_ppi_veg_chart,
                               options = list(
                                  opts_hover(css = hover_css),
                                  opts_hover_inv(css = "opacity:0.02"),
                                  opts_tooltip(
                                    zindex = 9999,
                                    css = "background-color:white;
         color:black;
         padding:10px;
         border-radius:5px;
         font-size:12pt;
         font-family:sans-serif;
         box-shadow:2px 2px 5px rgba(0,0,0,0.2);"
                                  )
         )
         ) 

input_ppi_veg_chart_interactive
```
:::

### Comparative Analysis

::: panel-tabset
#### Figure 1

```{r}

comparison_veg <- read_excel("C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\02_processed_data\\00_cleaned_data\\00_price_data\\00_overall\\02_comparative\\comparison_veg.xlsx") 

 last_values_veg <- comparison_veg %>% 
    filter(date < "2024-01-01") %>% 
    group_by(country) %>% 
    slice_max(date) %>% 
    ungroup()
  
  label_position_veg <- last_values_veg %>% 
    mutate(y_position = case_when(
      country == "EU27" & variable == "value_ppi" ~ value -5,
      country == "Ireland" & variable == "value_ppi"~ value +3,
      country == "Ireland" & variable == "value_hicp"~ value +3,
      country == "EU27" & variable == "value_hicp"~ value -3 
    ),
    x_position = case_when(
      country == "EU27" & variable == "value_ppi" ~ date - days(325),
      country == "Ireland" & variable == "value_ppi"~ date - days(75),
      country == "Ireland" & variable == "value_hicp"~ date - days(0),
      country == "EU27" & variable == "value_hicp"~ date + days(180) 
    ))
  

```

```{r}

comparison_veg_facet <- ggplot(comparison_veg, aes(x = date, y = value, color = variable)) +
    
    geom_line(linewidth = 0.75) +
    
    geom_point(aes(shape = country), size = 2) +
    
    geom_text(data = label_position_veg, aes(x = x_position, y = y_position,
                                               label = ifelse(variable == "value_hicp", "HICP", "PPI")), size = 2.5) +
    
    facet_wrap(~country, ncol = 2) +
    
    scale_color_manual(values = c("value_ppi" = "#3c5268", "value_hicp" = "#8fb6df"),
                       labels = c("HICP", "PPI")
    ) +
    
    scale_shape_manual(values = c("Ireland" = 15, "EU27" = 16)) +
    
    labs(
      title = "Are Irish Vegetable Margins Under Pressure? Consumer Prices Limiting \nProducer Price Growth Relative to EU-27?",
      subtitle = "**Producer and Consumer Price Divergence in Vegetable Supply Chain:** There has been substantial producer price compression in the Irish <br>vegetable 
    supply chain, relative to the EU27. The low growth in consumer prices for vegetables has acted as an anchor on producer price growth, <br>relative to 
    European competitors. This may be accounted for by intense price competition in the retail sector, greater retailer concentration <br>relative to EU 
    peers, higher import competition, retailer pricing strategies or potential market failures along the supply chain.",
      caption = "Source: Eurostat <br>Notes:
    Producer prices are prices received by the primary producer for agricultural produce. Farm-gate price ex VAT."
    ) +
    
    
    theme_minimal() +
    
 
 theme( 
    plot.title = element_text(face = "bold",colour = "#444444" , size = 15, hjust = 0), 
    plot.title.position = "plot",
    plot.subtitle = element_markdown( color= "#444444", size = 8.5, hjust = 0, lineheight = 1.3, margin = margin(t = 2, b = 5)),
    plot.caption.position = "plot",
    plot.caption = element_markdown(color = "#444444", size=7, hjust= 0, lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_text(size = 7, colour = "darkgray"),
    axis.line.y = element_line(colour = "darkgray", linewidth = 0.25),
    axis.line.x = element_line(colour = "darkgray", linewidth = 0.25),
    axis.ticks.y = element_line(colour = "darkgray", linewidth = 0.25),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_line(color = "#EEEEEE"), 
    legend.position = "none",
    legend.title = element_blank(),
    panel.background = element_rect(fill= "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    ) 
  
hover_css <- "
fill: #ffe7a6;
 fill-opacity:0.5;
  stroke-width: 2px;
  transition: fill-opacity 0.5s, stroke-width 0.5s, filter 0.5s;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
"

comparison_veg_facet_interactive <- girafe(ggobj = comparison_veg_facet,
                               options = list(
                                  opts_hover(css = hover_css),
                                  opts_hover_inv(css = "opacity:0.02"),
                                  opts_tooltip(
                                    zindex = 9999,
                                    css = "background-color:white;
         color:black;
         padding:10px;
         border-radius:5px;
         font-size:12pt;
         font-family:sans-serif;
         box-shadow:2px 2px 5px rgba(0,0,0,0.2);"
                                  )
         )
         ) 

comparison_veg_facet_interactive




```

#### Figure 2

```{r}
cumulative_veg <- read_excel("C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\02_processed_data\\00_cleaned_data\\00_price_data\\00_overall\\02_comparative\\cumulative_veg.xlsx") 
```

```{r}

 cumulative_veg_chart <- ggplot() +
     
     geom_point(data = cumulative_veg, aes(x = percentage, y = factor(country, levels = c("Ireland", "Spain", "Netherlands", "Belgium", "Poland")), color = variable ),
                size = 3.5) +
     
     geom_vline(xintercept = 47.58,
                color = "#8fb6df", linetype = 3, linewidth = 0.75 ) +
     geom_vline(xintercept = 50.38,
                color = "#3c5268", linetype = 3, linewidth = 0.75 ) +
     
     geom_text(data = data.frame(
       x = c(62, 59),
       y = c("Netherlands", "Ireland"),
       label = c("EU27 PPI", "EU27 HICP")
     ), aes(x = x, y = y, label = label), hjust = 0, size = 2.75, fontface = "bold", color = "#444444"
     ) +
     
     geom_segment(data = data.frame(
       x = c(60, 57),
       xend = c(52, 48.5),
       y = c("Netherlands", "Ireland"),
       yend = c("Netherlands", "Ireland")
     ),
     aes(x = x, xend = xend, y = y, yend = y),
     arrow = arrow(length = unit(0.2, "cm")),
     size = 0.35, color = "#444444"
     ) +
     
     scale_color_manual(values = c("percent_hicp" = "#8fb6df", "percent_ppi" = "#3c5268"))+
     
     scale_x_continuous(breaks = seq(-25,300, by = 25),
                        labels = function(x) paste0(x,"%")) +
     
     labs(
       title = "Irish Vegetable Growers Have Experienced the Slowest Growth in Prices \nSince 2015, Compared to EU Peers",
       subtitle = "**Percentage Change in Price Growth for Vegeatbles, 2015-2023: <span style='color:#8fb6df;'>**HICP**</span>,
    <span style='color:#3c5268;'>**PPI**</span>**. Vegetable growers in Ireland have seen the slowest growth in prices 
    <br>among European peers since 2015. They have also seen the largest divergence in growth relative to an EU27 benchmark, associated with minimal 
    <br>growth in consumer prices over the same period.",
       caption = "Source: Eurostat <br>Notes: HICP and PPI data for the United Kingdom is not available in 2023 from Eurostat. The dotted lines reference EU27 growth since 2015."
     ) +
     
     theme_minimal() +
     
     theme( 
    plot.title = element_text(face = "bold",colour = "#444444" , size = 15, hjust = 0), 
    plot.title.position = "plot",
    plot.subtitle = element_markdown( color= "#444444", size = 8.5, hjust = 0, lineheight = 1.3, margin = margin(t = 2, b = 5)),
    plot.caption.position = "plot",
    plot.caption = element_markdown(color = "#444444", size=7, hjust= 0, lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_text(size = 7, colour = "darkgray"),
    axis.line.y = element_line(colour = "darkgray", linewidth = 0.25),
    axis.line.x = element_line(colour = "darkgray", linewidth = 0.25),
    axis.ticks.y = element_line(colour = "darkgray", linewidth = 0.25),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_line(color = "#EEEEEE"), 
    legend.position = "none",
    legend.title = element_blank(),
    panel.background = element_rect(fill= "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    ) 
  
hover_css <- "
fill: #ffe7a6;
 fill-opacity:0.5;
  stroke-width: 2px;
  transition: fill-opacity 0.5s, stroke-width 0.5s, filter 0.5s;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
"

cumulative_veg_chart_interactive <- girafe(ggobj = cumulative_veg_chart,
                               options = list(
                                  opts_hover(css = hover_css),
                                  opts_hover_inv(css = "opacity:0.02"),
                                  opts_tooltip(
                                    zindex = 9999,
                                    css = "background-color:white;
         color:black;
         padding:10px;
         border-radius:5px;
         font-size:12pt;
         font-family:sans-serif;
         box-shadow:2px 2px 5px rgba(0,0,0,0.2);"
                                  )
         )
         ) 

cumulative_veg_chart_interactive 

   

```
:::
::::::::

### Column 2 {width="38.5%"}

::: {.card height="255px"}
```{r}
inflation_summary_ppi <- tibble(
  country = c("Ireland", "Ireland", "EU27", "EU27"),
  category = c( "Fruit", "Vegetables", "Fruit", "Vegetables"),
  inf_rate = c("31%", "29%", "54%", "48%")
) %>% 
  pivot_wider(
    names_from = country,
    values_from = inf_rate,
    id_cols = category
  )

inflation_table_ppi <- inflation_summary_ppi %>%
  kbl(
    caption = text_spec("Producer Price Increases by Category",
                        font_size = 16.5,
                        bold = TRUE,
                        color = "#444444"),
    col.names = c("", "Ireland", "EU")
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"),
    full_width = FALSE,
    position = "left"
  ) %>%
  
  row_spec(0, bold = FALSE , color = "white", background = "#8fb6df") %>% 
 
  
  collapse_rows(columns = 1) %>%
  footnote(
    general = "Comparison of inflation rates by category for Ireland and the EU-27 from 2015-2023",
    symbol = c("Source: Eurostat")
  )

inflation_table_ppi


```
:::

```{r}
bslib::value_box(
  title = HTML("<span style='font-size:1.2rem'>Squeezed Margin Growth - Veg:</span><span style='font-size:0.85rem'>Input cost growth was 29.24 % points bigger than producer price growth (2020-2023)"),
  value = "",
  subtitle = HTML("<span style='font-size:0.75rem'>Input Cost Growth vs Producer Price Growth (2020-2023)</span>"),
  theme =  value_box_theme(
    bg = "#3c5268",
    fg = "white"
  ),
  showcase = tags$img(src = "C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\09_icons\\down-arrow.png", height = 65),
  
  
)
```

```{r}
bslib::value_box(
  title = HTML("<span style='font-size:1.2rem'>Relative Cumulative Growth - Veg:</span><span style='font-size:0.85rem'>Cumulative growth in producer prices in Ireland was 19.8 % points below the EU27 (2015-2023)"),
  value = "",
  subtitle = HTML("<span style='font-size:0.75rem'>Input Cost Growth vs Producer Price Growth (2020-2023)</span>"),
  theme =  value_box_theme(
    bg = "#3c5268",
    fg = "white"
  ),
  showcase = tags$img(src = "C:\\Users\\Daniel.walsh\\Desktop\\Horticulture\\Horticulture\\Projects\\01_horticulture_public_data_projects\\00_horticulture_public_data_report_2025\\09_icons\\eu.png", height = 90),
  
  
)
```

# Mushrooms

# Potatoes

# Other Vegetables

# Other Fruit

# About
